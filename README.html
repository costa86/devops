<!DOCTYPE html>
    <html>
    <head>
        <meta charset="UTF-8">
        <title>DevOps</title>
        <style>
</style>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.css" integrity="sha384-yFRtMMDnQtDRO8rLpMIKrtPCD5jdktao2TV19YiZYWMDkUR5GQZR/NOVTdquEx1j" crossorigin="anonymous">
<link href="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.css" rel="stylesheet" type="text/css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/markdown.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/highlight.css">
<style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe WPC', 'Segoe UI', system-ui, 'Ubuntu', 'Droid Sans', sans-serif;
                font-size: 14px;
                line-height: 1.6;
            }
        </style>
        <style>
.task-list-item { list-style-type: none; } .task-list-item-checkbox { margin-left: -20px; vertical-align: middle; }
</style>
        
        <script src="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.js"></script>
        
    </head>
    <body class="vscode-body vscode-light">
        <h1 id="devops">DevOps</h1>
<h2 id="cheat-cheet">Cheat cheet</h2>
<h3 id="create-ssh-key">Create SSH-key</h3>
<ul>
<li>
<p>RSA - The default algorithm</p>
<pre><code>  ssh-keygen
</code></pre>
</li>
<li>
<p>Ed25519 - The newer and more secure algorithm</p>
<pre><code>  ssh-keygen -o -a &lt;number&gt; -t ed25519 -f ~/.ssh/&lt;key_custom_name&gt; -C &quot;&lt;comment&gt;&quot;
</code></pre>
<ul>
<li>&quot;-a&quot; -&gt;  Number of KDF (Key Derivation Function) rounds. Higher numbers result in slower passphrase verification, increasing the resistance to brute-force password cracking should the private-key be stolen. 100 is a good number</li>
<li>&quot;-o&quot; -&gt; Saves the private-key using the new OpenSSH format rather than the PEM format. Actually, this option is implied when you specify the key type as ed25519</li>
<li>&quot;-C&quot; -&gt; An identifier. Your email, e.g</li>
<li>&quot;-f&quot; -&gt; Specifies the filename of the generated key file. If you want it to be discovered automatically by the SSH agent, it must be stored in the default <code>.ssh</code> directory within your home directory.</li>
</ul>
</li>
<li>
<p>:warning: About</p>
</li>
</ul>
<h3 id="make-sure-ssh-agent-is-running">Make sure SSH agent is running</h3>
<p>In case you get &quot;Could not open a connection to your authentication agent&quot; error message.</p>
<p>Also, make sure the SSH agent is running before adding a new key (the <code>ssh-add</code> command)</p>
<pre><code>    eval `ssh-agent -s`
    #OR
    eval &quot;$(ssh-agent -s)&quot;
</code></pre>
<h3 id="add-keys">Add keys</h3>
<pre><code>    ssh-add &lt;private_part&gt;
</code></pre>
<h3 id="log-into-machine">Log into machine</h3>
<pre><code>    ssh &lt;user&gt;@&lt;ip&gt;
</code></pre>
<p>If you have multiple SSH keys, it's better to specify it, or else you might get an error about failed attempts:</p>
<pre><code>    ssh -i &lt;private_ssh&gt; &lt;user&gt;@&lt;ip&gt;
</code></pre>
<p>Extra:
append &quot;-v&quot; at the end to see details of the connection attempt</p>
<h3 id="linux-version">Linux version</h3>
<pre><code>    hostnamectl
</code></pre>
<h3 id="find-my-public-ip">Find my public IP</h3>
<ul>
<li>
<p>Local command</p>
<pre><code>  ifconfig
</code></pre>
</li>
<li>
<p>Web service</p>
<pre><code>  curl ifconfig.co/json
  #&quot;/json&quot; is optional, and returns:
  {
          &quot;ip&quot;: &quot;167.71.35.9&quot;,
          &quot;ip_decimal&quot;: 2806457097,
          &quot;country&quot;: &quot;Germany&quot;,
          &quot;country_iso&quot;: &quot;DE&quot;,
          &quot;country_eu&quot;: true,
          &quot;region_name&quot;: &quot;Hesse&quot;,
          &quot;region_code&quot;: &quot;HE&quot;,
          &quot;zip_code&quot;: &quot;60313&quot;,
          &quot;city&quot;: &quot;Frankfurt am Main&quot;,
          &quot;latitude&quot;: 50.1188,
          &quot;longitude&quot;: 8.6843,
          &quot;time_zone&quot;: &quot;Europe/Berlin&quot;,
          &quot;asn&quot;: &quot;AS14061&quot;,
          &quot;asn_org&quot;: &quot;DIGITALOCEAN-ASN&quot;,
          &quot;user_agent&quot;: {
          &quot;product&quot;: &quot;curl&quot;,
          &quot;version&quot;: &quot;7.68.0&quot;,
          &quot;raw_value&quot;: &quot;curl/7.68.0&quot;
          }
  }
</code></pre>
</li>
</ul>
<h3 id="restart-ssh-service">Restart SSH service</h3>
<p>When some changes are made, such as editing a config.file, e.g. For the changes to kick in.</p>
<pre><code>    systemctl restart sshd
</code></pre>
<h3 id="check-ssh-services-status">Check SSH service's status</h3>
<pre><code>    systemctl status sshd
</code></pre>
<h3 id="securely-transfercopy-files-from-local-to-server-machine">Securely transfer/copy files from LOCAL to SERVER machine</h3>
<ul>
<li>
<p>Single file</p>
<pre><code>  scp -i &lt;ssh_private&gt; &lt;src_file&gt; &lt;user&gt;@&lt;ip&gt;:&lt;target_dir&gt;
</code></pre>
</li>
<li>
<p>Directory</p>
<pre><code>  scp -r &lt;files_dir&gt; &lt;user&gt;@&lt;ip&gt;:&lt;target_dir&gt;
</code></pre>
</li>
<li>
<p>Chaining servers (sending files from local machine -&gt; server 1 -&gt; server 2)</p>
<pre><code>   scp &lt;src_file&gt; &lt;user_one&gt;@&lt;ip_one&gt; &lt;user_two&gt;@&lt;ip_two&gt;:&lt;target_dir_two&gt;
</code></pre>
</li>
</ul>
<h3 id="securely-transfercopy-files-from-server-to-local-machine">Securely transfer/copy files from SERVER to LOCAL machine</h3>
<pre><code>     scp &lt;user&gt;@&lt;ip&gt;:&lt;file_on_server&gt; &lt;destination_on_local&gt;
</code></pre>
<h3 id="run-script-in-remote-machine">Run script in remote machine</h3>
<p>From local machine.</p>
<p>Make sure the script is already on the target machine</p>
<pre><code>    ssh &lt;user&gt;@&lt;ip&gt; &quot;&lt;script_location_on_target_machine&gt;&quot;
</code></pre>
<h3 id="create-user">Create user</h3>
<pre><code>    adduser &lt;user&gt;
</code></pre>
<h3 id="give-sudo-permission-to-user">Give sudo permission to user</h3>
<pre><code>    usermod -aG sudo &lt;user&gt;
</code></pre>
<h3 id="see-user-permission">See user permission</h3>
<pre><code>    id &lt;user&gt;
</code></pre>
<h3 id="copy-files--preserve-permissions--change-ownership">Copy files &amp; preserve permissions &amp; change ownership</h3>
<p>In this example, we make a copy of the current user's .ssh folder into another user</p>
<pre><code>    rsync --archive --chown=&lt;target_user&gt;:&lt;target_user_group&gt; ~/.ssh /home/&lt;target_user&gt;
</code></pre>
<h3 id="change-user">Change user</h3>
<pre><code>    su &lt;user&gt;
</code></pre>
<h3 id="delete-user">Delete user</h3>
<pre><code>    userdel -r &lt;user&gt;
</code></pre>
<h3 id="get-number-of-existing-users">Get number of existing users</h3>
<pre><code>    getent passwd | wc -l
</code></pre>
<h3 id="search-for-a-user">Search for a user</h3>
<pre><code>    getent passwd | grep &lt;user&gt;
</code></pre>
<h3 id="copy-and-paste-helper">Copy and paste (helper)</h3>
<pre><code>    apt install xclip -y &amp;&amp; alias copy=&quot;xclip -sel clip&quot; &amp;&amp; alias paste=&quot;xclip -out -sel clip&quot;
</code></pre>
<p>The alias &quot;copy&quot; is equivalent to CTRL + C, and &quot;paste&quot; is equivalent to CTRL + V.</p>
<pre><code>    cat &lt;text_file_to_copy_content_from&gt; | copy
    paste
</code></pre>
<h3 id="update-packages-on-new-server">Update packages on new server</h3>
<p>Recommended after creating a new server</p>
<pre><code>    sudo apt update
    sudo apt upgrade
</code></pre>
<h3 id="disable-root-login-optional">Disable root login (optional)</h3>
<p>Open <code>etc/ssh/sshd_config</code> and set the following:</p>
<ul>
<li>
<p>PermitRootLogin no</p>
</li>
<li>
<p>PasswordAuthentication no</p>
</li>
</ul>
<h3 id="create-a-config-file-very-handy">Create a <code>config</code> file (very handy!)</h3>
<p>It makes it easier to log into remote server machines without needing to type their IP</p>
<p>Use <a href="./config">config</a> file as a template, and make sure it is placed in <code>.ssh</code> folder.
Usage:</p>
<pre><code>    ssh &lt;custom_name&gt;
</code></pre>
<h3 id="edit-profile-on-server-machine">Edit profile on server machine</h3>
<p><code>/etc/profile</code> is executed when the machine starts. It is a good place to set aliases and more commands.</p>
<h3 id="monitor-accesses-to-machine-very-useful">Monitor accesses to machine (very useful!)</h3>
<ul>
<li>
<p>You can check the contents of <code>/var/log/auth.log</code></p>
</li>
<li>
<p>Or you can user Journalctl (more suitable)</p>
</li>
</ul>
<p><a href="https://www.loggly.com/ultimate-guide/using-journalctl/?CMP=KNC-TAD-GGL-SW_EMEA_X_PP_CPC_LD_EN_PROD_SW-LGL-12302661005~119270368524_g_c_-b~497490656865~~20876~~">Article about journalctl</a></p>
<pre><code>    journalctl -fu ssh -o json-pretty
    #You can see all kinds of entries as well:
    journalctl
</code></pre>
<ul>
<li>&quot;-f&quot; -&gt; Follow changes in real time</li>
<li>&quot;-u&quot; -&gt; Service/daemon name (<code>ssh</code> for debian &amp; ubuntu or <code>sshd</code> for other distros)</li>
<li>&quot;-o json-pretty&quot; (optional) -&gt; Outputs as JSON (neat!)</li>
</ul>
<h3 id="ssh-via-android-device">SSH via Android device</h3>
<p>You can SSH into server machines using Android mobile apps.
Here, I used JuiceSSH - SSH Client.</p>
<ul>
<li>
<p>Download: <a href="https://play.google.com/store/apps/details?id=com.sonelli.juicessh">https://play.google.com/store/apps/details?id=com.sonelli.juicessh</a></p>
</li>
<li>
<p>A few actual scheenshots from the app (v3.2.2): <a href="./images">images</a></p>
</li>
</ul>
<h3 id="copy-ssh-key-from-local-to-server-machine">Copy SSH key from local to server machine</h3>
<p>In case SSH auth is not present on the server yet.</p>
<p>This will create <code>.ssh</code> folder on the server, along with <code>authorized_keys</code> file populated with local's public key</p>
<pre><code>    ssh-copy-id -i &lt;public_key&gt; &lt;user&gt;@&lt;ip&gt;</code></pre>

    </body>
    </html>